---
title: "Project 1"
author: "Christophe"
date: "February 20, 2016"
output: html_document
---



```{r}
library(data.table)
library(Hmisc)
tinfo <- file("https://raw.githubusercontent.com/ChristopheHunt/MSDA---Coursework/master/Data%20607/Homework/data/tournamentinfo.txt", open="r" )
chess.data <- readLines(tinfo) # read lines 
chess.data <- data.frame(chess.data, do.call(rbind, strsplit(chess.data, split = "|", fixed = TRUE)))
chess.data <- data.frame(lapply(chess.data, as.character), stringsAsFactors=FALSE)
chess.data <- chess.data[!grepl(".+--.+", chess.data$X1),] # removes "------" lines
chess.data <- chess.data[,-c(1,12)]
combine_rows <- function(dataframe){
                    df <- dataframe[0,]  ##create empty dataframe copy
                    for (i in colnames(dataframe)){  ## for all columns in data frame 
                        for (j in seq(1:length(dataframe[[i]]))){ ## for all rows in dataframe
                         df[j,i] <- gsub("\\s+"," ",(paste(dataframe[[i]][j:(j+1)], collapse = ""))) ## gsub removes extra spaces, then collapses two rows 
                        }
                    } 
          return(df) # return the dataframe
        }

chess.data <- (combine_rows(chess.data)) # run function on data frame
colnames(chess.data) <- chess.data[1,] # create column names from first row
chess.data <- chess.data[-(1:2),] # remove header information
index <- !is.na(as.numeric(gsub( " .*$", "",  str_trim(chess.data[,1])))) #gets the part of string, if a numeric value it converts to True
chess.data <- chess.data[index,] 
chess.data$ID <- str_trim(str_extract(chess.data[,1], "\\s[[0-9]]{1,}"))
chess.data$State <- str_trim(str_extract(chess.data[,1], "\\s[^[0-9]].+"))
chess.data$Name <- str_extract(chess.data[,2], ".[^[0-9]]{1,}")
chess.data$Pre.score <- str_extract(str_extract(chess.data[,2], ":.[[0-9]]{1,}.[^[-]]"), "[[0-9]]{1,}")
chess.data$Post.score <- str_extract(str_extract(chess.data[,2], ">.[[0-9]]{1,}"), "[[0-9]]{1,}")

split.round.columns <- function(dataframe){
                        df.colname <- colnames(dataframe[!is.na(str_extract(colnames(dataframe), "Round.+"))])
                        df <- dataframe[!is.na(str_extract(colnames(dataframe), "Round.+"))]
                        df.copy <- df[0,]  #empty dataframe copy
                        df.copy2 <- df[0,] 
                        for (i in df.colname){ 
                            for (j in seq(1:length(dataframe[[i]]))){
                                df.copy[j,i]  <- str_extract(dataframe[[i]][j], "[[:alpha:]]")
                                df.copy2[j,i] <- str_extract(dataframe[[i]][j], "[[0-9]]{1,}")
                           }
                         } 
                      colnames(df.copy) <- paste(str_trim(df.colname), "Results")
                      colnames(df.copy2) <- paste(str_trim(df.colname), "Opponent")
                      for (t in (seq(1:ncol(df)))){
                          dataframe <- cbind(dataframe, df.copy[,t, drop = FALSE])
                          dataframe <- cbind(dataframe, df.copy2[,t, drop = FALSE])
                      }
    return(dataframe) 
  }

chess.data <- split.round.columns(chess.data)
chess.data <- chess.data[,-c(1:10)]
```




